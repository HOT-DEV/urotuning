{% if template contains 'product' %}
<script>
setTimeout(function(){  
  // native promise only
  !function(t,n,e){n[t]=n[t]||e(),"undefined"!=typeof module&&module.exports?module.exports=n[t]:"function"==typeof define&&define.amd&&define(function(){return n[t]})}("Promise","undefined"!=typeof global?global:this,function(){"use strict";function t(t,n){l.add(t,n),h||(h=y(l.drain))}function n(t){var n,e=typeof t;return null==t||"object"!=e&&"function"!=e||(n=t.then),"function"==typeof n?n:!1}function e(){for(var t=0;t<this.chain.length;t++)o(this,1===this.state?this.chain[t].success:this.chain[t].failure,this.chain[t]);this.chain.length=0}function o(t,e,o){var r,i;try{e===!1?o.reject(t.msg):(r=e===!0?t.msg:e.call(void 0,t.msg),r===o.promise?o.reject(TypeError("Promise-chain cycle")):(i=n(r))?i.call(r,o.resolve,o.reject):o.resolve(r))}catch(c){o.reject(c)}}function r(o){var c,u=this;if(!u.triggered){u.triggered=!0,u.def&&(u=u.def);try{(c=n(o))?t(function(){var t=new f(u);try{c.call(o,function(){r.apply(t,arguments)},function(){i.apply(t,arguments)})}catch(n){i.call(t,n)}}):(u.msg=o,u.state=1,u.chain.length>0&&t(e,u))}catch(a){i.call(new f(u),a)}}}function i(n){var o=this;o.triggered||(o.triggered=!0,o.def&&(o=o.def),o.msg=n,o.state=2,o.chain.length>0&&t(e,o))}function c(t,n,e,o){for(var r=0;r<n.length;r++)!function(r){t.resolve(n[r]).then(function(t){e(r,t)},o)}(r)}function f(t){this.def=t,this.triggered=!1}function u(t){this.promise=t,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function a(n){if("function"!=typeof n)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var o=new u(this);this.then=function(n,r){var i={success:"function"==typeof n?n:!0,failure:"function"==typeof r?r:!1};return i.promise=new this.constructor(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");i.resolve=t,i.reject=n}),o.chain.push(i),0!==o.state&&t(e,o),i.promise},this["catch"]=function(t){return this.then(void 0,t)};try{n.call(void 0,function(t){r.call(o,t)},function(t){i.call(o,t)})}catch(c){i.call(o,c)}}var s,h,l,p=Object.prototype.toString,y="undefined"!=typeof setImmediate?function(t){return setImmediate(t)}:setTimeout;try{Object.defineProperty({},"x",{}),s=function(t,n,e,o){return Object.defineProperty(t,n,{value:e,writable:!0,configurable:o!==!1})}}catch(d){s=function(t,n,e){return t[n]=e,t}}l=function(){function t(t,n){this.fn=t,this.self=n,this.next=void 0}var n,e,o;return{add:function(r,i){o=new t(r,i),e?e.next=o:n=o,e=o,o=void 0},drain:function(){var t=n;for(n=e=h=void 0;t;)t.fn.call(t.self),t=t.next}}}();var g=s({},"constructor",a,!1);return a.prototype=g,s(g,"__NPO__",0,!1),s(a,"resolve",function(t){var n=this;return t&&"object"==typeof t&&1===t.__NPO__?t:new n(function(n,e){if("function"!=typeof n||"function"!=typeof e)throw TypeError("Not a function");n(t)})}),s(a,"reject",function(t){return new this(function(n,e){if("function"!=typeof n||"function"!=typeof e)throw TypeError("Not a function");e(t)})}),s(a,"all",function(t){var n=this;return"[object Array]"!=p.call(t)?n.reject(TypeError("Not an array")):0===t.length?n.resolve([]):new n(function(e,o){if("function"!=typeof e||"function"!=typeof o)throw TypeError("Not a function");var r=t.length,i=Array(r),f=0;c(n,t,function(t,n){i[t]=n,++f===r&&e(i)},o)})}),s(a,"race",function(t){var n=this;return"[object Array]"!=p.call(t)?n.reject(TypeError("Not an array")):new n(function(e,o){if("function"!=typeof e||"function"!=typeof o)throw TypeError("Not a function");c(n,t,function(t,n){e(n)},o)})}),a});
  // NodeList.prototype.forEach
  if (window.NodeList && !NodeList.prototype.forEach) { NodeList.prototype.forEach = Array.prototype.forEach;}
  // String.prototype.includes
  String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}});
  // DOMObserver
  !function(e){var t={};function r(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)r.d(n,u,function(t){return e[t]}.bind(null,u));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){function r(e,t,r,n,u,o,a){try{var c=e[o](a),i=c.value}catch(e){return void r(e)}c.done?t(i):Promise.resolve(i).then(n,u)}function n(e){return function(){var t=this,n=arguments;return new Promise(function(u,o){var a=e.apply(t,n);function c(e){r(a,u,o,c,i,"next",e)}function i(e){r(a,u,o,c,i,"throw",e)}c(void 0)})}}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,u=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(n=(a=c.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){u=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(u)throw o}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}!function(e,t){var r=function(t,r,n){var i=this;return new e(function(e,u){o(r)||a(r)||c(r)||u(new Error("SearchTerm is not valid CSS selector, Regular Expression or Map"));var v={subtree:!0,childList:1===t,characterDataOldValue:3===t,attributeOldValue:2===t};2===t&&(c(r)?v.attributeFilter=Array.from(r.keys()):u(new Error("You can only use Map to observe attribute chanage"))),3===t&&(a(r)||u(new Error("You can only use regular expression to observe characterdata change")));var y=new MutationObserver(function(r){var o,a=[];switch(t*n){case 1:o=l;break;case 2:o=s;break;case 3:o=h;break;case-1:o=p;break;case-2:o=f;break;case-3:o=d;break;default:u(new Error("type * addOrRemove = ".concat(t*n)))}(a=(a=r.reduce(o,[])).filter(function(e,t,r){return r.indexOf(e)===t})).length>0&&(y.disconnect(),e(a))});y.observe(i,v)});function s(e,t){var n=t.target,o=t.attributeName,a=t.oldValue;return Array.from(r.entries()).forEach(function(t){var r=u(t,2),c=r[0],i=r[1];if(o==c){var s=n["class"===c?"className":c];s!==i&&!s.includes(i)||a==i||a.includes(i)||e.push(n)}}),e}function l(e,t){return t.addedNodes.forEach(function(t){o(r)&&(1===t.nodeType&&(t.querySelectorAll(r)&&t.querySelectorAll(r).length&&t.querySelectorAll(r).length>0?t.querySelectorAll(r).forEach(function(t){e.push(t)}):t.matches(r)&&e.push(t)),3===t.nodeType&&t.parentNode&&((t=t.parentNode).querySelectorAll(r)&&t.querySelectorAll(r).length&&t.querySelectorAll(r).length>0?t.querySelectorAll(r).forEach(function(t){e.push(t)}):t.matches(r)&&e.push(t)));a(r)&&(3===t.nodeType&&r.test(t.textContent)&&e.push(t.parentNode),1===t.nodeType&&r.test(t.innerHTML)&&e.push(t))}),e}function f(e,t){var n=t.target,o=t.attributeName,a=t.oldValue;return Array.from(r.entries()).forEach(function(t){var r=u(t,2),c=r[0],i=r[1];if(o===c){var s=n["class"===c?"className":c];a!==i&&!a.includes(i)||s===i||s.includes(i)||e.push(n)}}),e}function p(e,t){var n=t.removedNodes,u=t.target;return n.forEach(function(t){o(r)&&1===t.nodeType&&(t.querySelector(r)||t.matches(r))&&e.push(u),a(r)&&(3===t.nodeType&&r.test(t.textContent)&&e.push(u),1===t.nodeType&&r.test(t.innerHTML)&&e.push(u))}),e}function h(e,t){var n=t.target,u=t.oldValue,o=n.textContent;return r.test(o)&&!r.test(u)&&e.push(n.parentNode),e}function d(e,t,n,u){var o=t.target,a=t.oldValue,c=o.textContent;return r.test(a)&&!r.test(c)&&e.push(o.parentNode),e}};function o(e){if("string"!=typeof e)return!1;try{return document.querySelector(e),!0}catch(e){return!1}}function a(e){return e instanceof RegExp}function c(e){return e instanceof Map&&Array.from(e.keys()).every(function(e){return"string"==typeof e})&&Array.from(e.values()).every(function(e){return"string"==typeof e})}function i(e,t){return s.apply(this,arguments)}function s(){return(s=n(regeneratorRuntime.mark(function e(t,n){var u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.call(this,1,t,n);case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function l(e,t){return f.apply(this,arguments)}function f(){return(f=n(regeneratorRuntime.mark(function e(t,n){var u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.call(this,2,t,n);case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function p(e,t){return h.apply(this,arguments)}function h(){return(h=n(regeneratorRuntime.mark(function e(t,n){var u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.call(this,3,t,n);case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var d=function(){var t=n(regeneratorRuntime.mark(function t(r){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.call(this,r,1);case 2:return n=t.sent,t.abrupt("return",e.resolve(n));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),v=function(){var t=n(regeneratorRuntime.mark(function t(r){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.call(this,r,-1);case 2:return n=t.sent,t.abrupt("return",e.resolve(n));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),y=function(){var t=n(regeneratorRuntime.mark(function t(r){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.call(this,r,1);case 2:return n=t.sent,t.abrupt("return",e.resolve(n));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=n(regeneratorRuntime.mark(function t(r){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.call(this,r,-1);case 2:return n=t.sent,t.abrupt("return",e.resolve(n));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),b=function(){var t=n(regeneratorRuntime.mark(function t(r){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.call(this,r,1);case 2:return n=t.sent,t.abrupt("return",e.resolve(n));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),g=function(){var t=n(regeneratorRuntime.mark(function t(r){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.call(this,r,-1);case 2:return n=t.sent,t.abrupt("return",e.resolve(n));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}();Object.assign(t.prototype,{onceNodeInserted:y,onNodeInserted:function(e,t){var r=this;y.call(r,e).then(function n(u){t(u),y.call(r,e).then(n)})},onceNodeRemoved:m,onNodeRemoved:function(e,t){var r=this;m.call(r,e).then(function t(n){m.call(r,e).then(t)})},onceAttributeAdded:b,onAttributeAdded:function(e,t){var r=this;b.call(r,e).then(function n(u){t(u),b.call(r,e).then(n)})},onceAttributeRemoved:g,onAttributeRemoved:function(e,t){var r=this;g.call(r,e).then(function n(u){t(u),g.call(r,e).then(n)})},onceTextAdded:d,onceTextRemoved:v,onTextAdded:function(e,t){var r=this;d.call(r,e).then(function n(u){t(u),d.call(r,e).then(n)})},onTextRemoved:function(e,t){var r=this;v.call(r,e).then(function n(u){t(u),v.call(r,e).then(n)})}})}(Promise,HTMLElement)}]);

  document.documentElement.onceNodeInserted("span.bold_option_price_display")
  .then(function updateAffirm(priceElements){

    var current_real_price = priceElements[0].textContent.replace(/[^\d.]/g,'')*100;
    console.log(current_real_price);
    if(current_real_price && typeof current_real_price == 'number'){
      $('.affirm-as-low-as').attr('data-amount', current_real_price);
      if(window.affirm
         && affirm.ui
         && typeof affirm.ui.refresh == 'function'){
        affirm.ui.refresh();
      }
    }
    document.documentElement.onceNodeInserted("span.bold_option_price_display")
    .then(updateAffirm);
  });
}, 500);
</script>
{% endif %}